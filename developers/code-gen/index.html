

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
 Generated by Apache Maven Doxia
 Rendered using Reflow Maven Skin 1.5.0 (http://devacfr.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">
          
        <head>
    <meta charset="UTF-8" />
    <title>Apache PLC4X® - Code Generation</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
      <meta http-equiv="content-language" content="en" />
                                                                <link href="../../css/bootstrap.min.css" rel="stylesheet" />
                <link href="../../css/docs.css" rel="stylesheet" />
    <link href="../../css/reflow-skin.css" rel="stylesheet" />

    <link rel="stylesheet" href="../../js/styles/default.min.css" />

    <link href="../../css/lightbox.css" rel="stylesheet" />
    <link href="../../css/site.css" rel="stylesheet" />
    <link href="../../css/print.css" rel="stylesheet" media="print" />
<script>
          document.addEventListener("DOMContentLoaded", function(event) {
            /* Add an image for promoting Apache events below the right banner */
            $("#bannerRight").append('<p id="apacheEvents"><a href="//www.apache.org/events/current-event.html"><img src="//www.apache.org/events/current-event-234x60.png"/></a></p>');
            /* Append the trademarks info to the copyright section */
            $(".copyright").append('<p>Apache PLC4X, PLC4X, Apache, the Apache feather logo, and the Apache PLC4X project logo are either registered trademarks or trademarks of The Apache Software Foundation in the United States and other countries. All other marks mentioned may be trademarks or registered trademarks of their respective owners.</p>');
          });
        </script>
        </head> <!-- end : head -->
    <body class="page-developers-code-gen-index project-plc4x-parent">

    <div id="m-top-navbar" class="navbar  navbar-default navbar-fixed-top">
      <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                        data-target="#top-navbar-collapse-1" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    </button>
                        <a class="navbar-brand" href="../..">Apache PLC4X</a>
        </div> <!-- .navbar-header -->
        <div class="collapse navbar-collapse" id="top-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Users <b class="caret"></b></a>
                <ul class="dropdown-menu">
                    <li ><a  href="../../users/download.html"  title="Download" >Download</a></li>
                    <li ><a  href="../../users/gettingstarted.html"  title="Getting Started" >Getting Started</a></li>
                    <li ><a  href="../../users/opm.html"  title="Object PLC Mapping (OPM)" >Object PLC Mapping (OPM)</a></li>
                    <li ><a  href="../../users/industry40.html"  title="Industry 4.0 with Apache" >Industry 4.0 with Apache</a></li>
                    <li ><a  href="../../users/security.html"  title="Security" >Security</a></li>
            </ul>
        </li>
                            <li class="dropdown active">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Developers <b class="caret"></b></a>
                <ul class="dropdown-menu">
                    <li ><a  href="../issues.html"  title="Bug & Issue Tracker" >Bug & Issue Tracker</a></li>
                    <li ><a  href="../building.html"  title="Building PLC4X" >Building PLC4X</a></li>
                    <li ><a  href="../sonar.html"  title="Code Analysis" >Code Analysis</a></li>
                                    <li class="dropdown-submenu active">
<a  href=""  title="Code Generation" >Code Generation</a>                    <ul class="dropdown-menu">
                        <li ><a  href="protocol/mspec.html"  title="Protocol: MSpec Format" >Protocol: MSpec Format</a></li>
                        <li ><a  href="language/freemarker.html"  title="Language: Apache Freemarker" >Language: Apache Freemarker</a></li>
                    </ul>
                </li>
                    <li ><a  href="../ci.html"  title="Continuous Integration" >Continuous Integration</a></li>
                    <li ><a  href="../contributing.html"  title="Contributing" >Contributing</a></li>
                    <li ><a  href="../decisions.html"  title="Decision Making" >Decision Making</a></li>
                    <li ><a  href="../maturity.html"  title="Maturity" >Maturity</a></li>
                    <li ><a  href="../preparing.html"  title="Preparing your Computer" >Preparing your Computer</a></li>
                    <li ><a  href="../release.html"  title="Releasing" >Releasing</a></li>
                    <li ><a  href="../team.html"  title="Team" >Team</a></li>
                    <li ><a  href="../vm.html"  title="VM Access" >VM Access</a></li>
                    <li ><a  href="../vpn.html"  title="VPN Access" >VPN Access</a></li>
                    <li ><a  href="../website.html"  title="Website" >Website</a></li>
                    <li ><a  href="../wiki.html"  title="Wiki" >Wiki</a></li>
            </ul>
        </li>
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Protocols <b class="caret"></b></a>
                <ul class="dropdown-menu">
                    <li ><a  href="../../protocols/features.html"  title="Features" >Features</a></li>
                    <li ><a  href="../../protocols/ads/index.html"  title="ADS" >ADS</a></li>
                    <li ><a  href="../../protocols/delta-v/index.html"  title="DeltaV" >DeltaV</a></li>
                    <li ><a  href="../../protocols/ethernet-ip/index.html"  title="EtherNet/IP" >EtherNet/IP</a></li>
                    <li ><a  href="../../protocols/modbus/index.html"  title="Modbus" >Modbus</a></li>
                    <li ><a  href="../../protocols/opc-ua/index.html"  title="OPC-UA" >OPC-UA</a></li>
                    <li ><a  href="../../protocols/s7/index.html"  title="S7" >S7</a></li>
            </ul>
        </li>
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reports <b class="caret"></b></a>
                <ul class="dropdown-menu">
                    <li class="dropdown-submenu ">
<a  href="../../project-info.html"  title="Project Information" >Project Information</a>                    <ul class="dropdown-menu">
                        <li ><a  href="../../dependency-convergence.html"  title="Dependency Convergence" >Dependency Convergence</a></li>
                        <li ><a  href="../../dependency-info.html"  title="Dependency Information" >Dependency Information</a></li>
                        <li ><a  href="../../dependency-management.html"  title="Dependency Management" >Dependency Management</a></li>
                        <li ><a  href="../../distribution-management.html"  title="Distribution Management" >Distribution Management</a></li>
                        <li ><a  href="../../index.html"  title="About" >About</a></li>
                        <li ><a  href="../../issue-management.html"  title="Issue Management" >Issue Management</a></li>
                        <li ><a  href="../../licenses.html"  title="Licenses" >Licenses</a></li>
                        <li ><a  href="../../mailing-lists.html"  title="Mailing Lists" >Mailing Lists</a></li>
                        <li ><a  href="../../modules.html"  title="Project Modules" >Project Modules</a></li>
                        <li ><a  href="../../plugin-management.html"  title="Plugin Management" >Plugin Management</a></li>
                        <li ><a  href="../../plugins.html"  title="Plugins" >Plugins</a></li>
                        <li ><a  href="../../scm.html"  title="Source Code Management" >Source Code Management</a></li>
                        <li ><a  href="../../summary.html"  title="Summary" >Summary</a></li>
                    </ul>
                </li>
            </ul>
        </li>
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Apache <b class="caret"></b></a>
                <ul class="dropdown-menu">
                    <li ><a  href="http://www.apache.org"  title="Apache Software Foundation"  class="externalLink" >Apache Software Foundation</a></li>
                    <li ><a  href="https://www.apache.org/foundation/how-it-works.html"  title="How Apache Works"  class="externalLink" >How Apache Works</a></li>
                    <li ><a  href="http://www.apache.org/licenses"  title="License"  class="externalLink" >License</a></li>
                    <li ><a  href="http://www.apache.org/foundation/sponsorship.html"  title="Sponsoring Apache"  class="externalLink" >Sponsoring Apache</a></li>
                    <li ><a  href="http://www.apache.org/foundation/thanks.html"  title="Thanks"  class="externalLink" >Thanks</a></li>
            </ul>
        </li>
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Modules <b class="caret"></b></a>
                <ul class="dropdown-menu">
                    <li ><a  href="../../plc4x-build-utils/index.html"  title="PLC4X: Build Utils" >PLC4X: Build Utils</a></li>
                    <li ><a  href="../../plc4x-protocols/index.html"  title="Protocols" >Protocols</a></li>
                    <li ><a  href="../../plc4x-tools/index.html"  title="Tools" >Tools</a></li>
                    <li ><a  href="../../plc4j/index.html"  title="PLC4J" >PLC4J</a></li>
                    <li ><a  href="../../plc4net/index.html"  title="PLC4Net" >PLC4Net</a></li>
                    <li ><a  href="../../plc4py/index.html"  title="PLC4PY" >PLC4PY</a></li>
            </ul>
        </li>
            </ul>
        </div><!--/.nav-collapse -->
      </div> <!--/.container -->
    </div> <!--/.navbar -->
  <div class="container">
  <!-- Masthead -->
  <!-- ================================================== -->  <div class="header container-fluid">
  <div class="jumbotron subhead">
    <div class="row" id="banner">
      <div class="col-md-12">
        <div class="pull-left">
                                      <a href="https://plc4x.apache.org/" id="bannerLeft">
                    <img src="https://plc4x.apache.org/images/apache_plc4x_logo.png"
                 alt='"'Apache PLC4X'"'
 />            </a>
                    <p class="lead">The industrial IoT adapter</p>
        </div>
        <div class="pull-right">
                                      <a href="http://www.apache.org/" id="bannerRight">
                    <img src="https://plc4x.apache.org/images/apache_logo.png"
                 alt='"'Apache Software Foundation'"'
 />            </a>
        </div>
      </div>
    </div>
  </div>
    <hr class="toc-separator" />
    <div id="toc-bar" class="navbar navbar-default">
      <div id="toc-scroll-target" class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#toc-nav-collapse" aria-expanded="false">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
            </div> <!-- .navbar-header -->
        <div class="collapse navbar-collapse" id="toc-nav-collapse">
          <ul id="toc" class="nav navbar-nav">
                                                            <li class="toplevel"><a href="#_toc_code_generation1" title="Code Generation">Code Generation</a></li>
                        <li class="toplevel"><a href="#_toc_introduction1" title="Introduction">Introduction</a></li>
                        <li class="toplevel"><a href="#_toc_configuration1" title="Configuration">Configuration</a></li>
                        <li class="dropdown">
                            <a href="#" title="Custom Modules" class="dropdown-toggle" role="button" data-toggle="dropdown">Custom Modules <b class="caret"></b></a>
                            <ul class="dropdown-menu" role="menu">
                                <!-- Repeat the item, otherwise it is not clickable as the dropdown root -->
                                <li><a href="#_toc_custom_modules1" title="Custom Modules">Custom Modules</a></li>
                                <li class="divider"></li>
                                              <li><a href="#_toc_protocol_modules1" title="Protocol Modules">Protocol Modules</a></li>
                <li><a href="#_toc_language_modules1" title="Language Modules">Language Modules</a></li>
                            </ul>
                        </li>
                        <li class="dropdown">
                            <a href="#" title="Problems with Maven" class="dropdown-toggle" role="button" data-toggle="dropdown">Problems with Maven <b class="caret"></b></a>
                            <ul class="dropdown-menu" role="menu">
                                <!-- Repeat the item, otherwise it is not clickable as the dropdown root -->
                                <li><a href="#_toc_problems_with_maven1" title="Problems with Maven">Problems with Maven</a></li>
                                <li class="divider"></li>
                                              <li><a href="#_toc_why_are_the_4_modules_released_separately1" title="Why are the 4 modules released separately?">Why are the 4 modules released separately?</a></li>
                <li><a href="#_toc_why_are_the_protocol_and_language_dependencies_don" title="Why are the protocol and language dependencies done so strangely?">Why are the protocol and language dependencies done so strangely?</a></li>
                            </ul>
                        </li>
          </ul>
        </div>
      </div> <!-- .container -->
    </div> <!-- end: toc-bar -->
  </div> <!-- end : header -->
  <div class="main-body">

  <div class="row">
    <div class="col-md-12">
      <div class="body-content">
<div class="sect1"> 
 <div class="page-header">
  <h2 id="_toc_code_generation1">Code Generation</h2>
 </div> 
 <div class="sectionbody"> 
  <div class="paragraph"> 
   <p>As hand-writing code for a lot of drivers in multiple languages would be quite a nightmare, we have invested a very large amount of time into finding a way to automate this.</p> 
  </div> 
  <div class="paragraph"> 
   <p>So in the end we need 3 parts:</p> 
  </div> 
  <div class="olist arabic"> 
   <ol class="arabic"> 
    <li> <p>Protocol definition</p> </li> 
    <li> <p>Language template</p> </li> 
    <li> <p>A maven plugin which generates the code</p> </li> 
   </ol> 
  </div> 
  <div class="paragraph"> 
   <p>This maven plugin uses a given protocol definition as well as a language template and generates code for reading/writing data in that protocol with the given language.</p> 
  </div> 
  <div class="imageblock"> 
   <div class="content"> 
    <img src="../../images/code-generation-intro.png" alt="code generation intro" width="750" height="308" class="img-responsive"> 
   </div> 
  </div> 
  <div class="paragraph"> 
   <p>The <code>Types Base</code> module provides all the structures the <code>Protocol</code> modules output which are then used in the <code>Language</code> templates to generate code.</p> 
  </div> 
  <div class="paragraph"> 
   <p><code>Protocol Base</code> and <code>Language Base</code> hereby just provide the interfaces that reference these types and provide the API for the <code>plc4x-maven-plugin</code> to use.</p> 
  </div> 
  <div class="paragraph"> 
   <p>These modules are also maintained in a repository which is separate from the rest of the PLC4X code.</p> 
  </div> 
  <div class="paragraph"> 
   <p>This is due to some restrictions in the Maven build system. If you are interested in understanding the reasons - please read the chapter on <code>Problems with Maven</code> near the end of this page.</p> 
  </div> 
  <div class="paragraph"> 
   <p>Concrete protocol spec parsers and templates that actually generate code are implemented in derived modules.</p> 
  </div> 
  <div class="paragraph"> 
   <p>Also didn’t we want to tie ourselves to only one way to specify protocols and to generate code.</p> 
  </div> 
  <div class="paragraph"> 
   <p>This adds another layer to the hierarchy.</p> 
  </div> 
  <div class="paragraph"> 
   <p>So for example in case of generating a Siemens S7 Driver for Java this would look like this:</p> 
  </div> 
  <div class="imageblock"> 
   <div class="content"> 
    <img src="../../images/code-generation-intro-s7-java.png" alt="code generation intro s7 java" width="480" height="728" class="img-responsive"> 
   </div> 
  </div> 
  <div class="paragraph"> 
   <p>The dark blue parts are the ones released externally, the turquoise ones are part of the main PLC4X repo.</p> 
  </div> 
  <div class="sect2"> 
   <h3 id="_toc_introduction1">Introduction</h3> 
   <div class="paragraph"> 
    <p>The maven plugin is built up very modular.</p> 
   </div> 
   <div class="paragraph"> 
    <p>So in general it is possible to add new forms of providing protocol definitions as well as language templates.</p> 
   </div> 
   <div class="paragraph"> 
    <p>For the formats of specifying a protocol we have tried out numerous tools and frameworks, however the results were never quite satisfying.</p> 
   </div> 
   <div class="paragraph"> 
    <p>Usually using them required a large amount of workarounds, which made the solution quite complicated.</p> 
   </div> 
   <div class="paragraph"> 
    <p>In the end only DFDL and the corresponding Apache project <a href="https://daffodil.apache.org">Apache Daffodil (incubating)</a> seemed to provide what we were looking for.</p> 
   </div> 
   <div class="paragraph"> 
    <p>With this we were able to provide first driver versions fully specified in XML.</p> 
   </div> 
   <div class="paragraph"> 
    <p>The downside was, that the PLC4X community regarded this XML format as pretty complicated and when implementing an experimental code generator we quickly noticed that generating a nice object model would not be possible, due to the lack ability to model the inheritance of types in DFDL.</p> 
   </div> 
   <div class="paragraph"> 
    <p>In the end we came up with our own solution which we called <code>MSpec</code> and is described in the <a href="protocol/mspec.html">MSpec Format description</a>.</p> 
   </div> 
  </div> 
  <div class="sect2"> 
   <h3 id="_toc_configuration1">Configuration</h3> 
   <div class="paragraph"> 
    <p>The <code>plc4x-maven-plugin</code> has a very limited set of configuration options.</p> 
   </div> 
   <div class="paragraph"> 
    <p>In general all you need to specify, is the <code>protocolName</code> and the <code>languageName</code>.</p> 
   </div> 
   <div class="paragraph"> 
    <p>There is also an additional parameter: <code>outputDir</code>, which defaults to <code>${project.build.directory}/generated-sources/plc4x/</code> and usually shouldn’t require being changed.</p> 
   </div> 
   <div class="paragraph"> 
    <p>Here’s an example of a driver pom for building a <code>S7</code> driver for <code>java</code>:</p> 
   </div> 
   <div class="literalblock"> 
    <div class="content"> 
     <pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!--
  Licensed to the Apache Software Foundation (ASF) under one
  or more contributor license agreements.  See the NOTICE file
  distributed with this work for additional information
  regarding copyright ownership.  The ASF licenses this file
  to you under the Apache License, Version 2.0 (the
  "License"); you may not use this file except in compliance
  with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing,
  software distributed under the License is distributed on an
  "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, either express or implied.  See the License for the
  specific language governing permissions and limitations
  under the License.
  --&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

  &lt;parent&gt;
    &lt;groupId&gt;org.apache.plc4x.plugins&lt;/groupId&gt;
    &lt;artifactId&gt;plc4x-code-generaton&lt;/artifactId&gt;
    &lt;version&gt;0.5.0-SNAPSHOT&lt;/version&gt;
  &lt;/parent&gt;

  &lt;artifactId&gt;test-java-s7-driver&lt;/artifactId&gt;

  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.plc4x.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;plc4x-maven-plugin&lt;/artifactId&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;id&gt;test&lt;/id&gt;
            &lt;phase&gt;generate-sources&lt;/phase&gt;
            &lt;goals&gt;
              &lt;goal&gt;generate-driver&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
              &lt;protocolName&gt;s7&lt;/protocolName&gt;
              &lt;languageName&gt;java&lt;/languageName&gt;
            &lt;/configuration&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;

  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.apache.plc4x.plugins&lt;/groupId&gt;
      &lt;artifactId&gt;plc4x-code-generation-driver-base-java&lt;/artifactId&gt;
      &lt;version&gt;0.5.0-SNAPSHOT&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;dependency&gt;
      &lt;groupId&gt;org.apache.plc4x.plugins&lt;/groupId&gt;
      &lt;artifactId&gt;plc4x-code-generation-language-java&lt;/artifactId&gt;
      &lt;version&gt;0.5.0-SNAPSHOT&lt;/version&gt;
      &lt;!-- Scope is 'provided' as this way it's not shipped with the driver --&gt;
      &lt;scope&gt;provided&lt;/scope&gt;
    &lt;/dependency&gt;

    &lt;dependency&gt;
      &lt;groupId&gt;org.apache.plc4x.plugins&lt;/groupId&gt;
      &lt;artifactId&gt;plc4x-code-generation-protocol-s7&lt;/artifactId&gt;
      &lt;version&gt;0.5.0-SNAPSHOT&lt;/version&gt;
      &lt;!-- Scope is 'provided' as this way it's not shipped with the driver --&gt;
      &lt;scope&gt;provided&lt;/scope&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;

&lt;/project&gt;</pre> 
    </div> 
   </div> 
   <div class="paragraph"> 
    <p>So the plugin configuration is pretty straight forward, all that is specified, is the <code>protocolName</code> and the <code>languageName</code>.</p> 
   </div> 
   <div class="paragraph"> 
    <p>The dependency:</p> 
   </div> 
   <div class="literalblock"> 
    <div class="content"> 
     <pre>&lt;dependency&gt;
  &lt;groupId&gt;org.apache.plc4x.plugins&lt;/groupId&gt;
  &lt;artifactId&gt;plc4x-code-generation-driver-base-java&lt;/artifactId&gt;
  &lt;version&gt;0.5.0-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;</pre> 
    </div> 
   </div> 
   <div class="paragraph"> 
    <p>For example contains all classes the generated code relies on.</p> 
   </div> 
   <div class="paragraph"> 
    <p>The definitions of both the <code>s7</code> protocol as well as the <code>java</code> language are provided by the two dependencies:</p> 
   </div> 
   <div class="literalblock"> 
    <div class="content"> 
     <pre>&lt;dependency&gt;
  &lt;groupId&gt;org.apache.plc4x.plugins&lt;/groupId&gt;
  &lt;artifactId&gt;plc4x-code-generation-language-java&lt;/artifactId&gt;
  &lt;version&gt;0.5.0-SNAPSHOT&lt;/version&gt;
  &lt;!-- Scope is 'provided' as this way it's not shipped with the driver --&gt;
  &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;</pre> 
    </div> 
   </div> 
   <div class="paragraph"> 
    <p>and:</p> 
   </div> 
   <div class="literalblock"> 
    <div class="content"> 
     <pre>&lt;dependency&gt;
  &lt;groupId&gt;org.apache.plc4x.plugins&lt;/groupId&gt;
  &lt;artifactId&gt;plc4x-code-generation-protocol-s7&lt;/artifactId&gt;
  &lt;version&gt;0.5.0-SNAPSHOT&lt;/version&gt;
  &lt;!-- Scope is 'provided' as this way it's not shipped with the driver --&gt;
  &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;</pre> 
    </div> 
   </div> 
   <div class="paragraph"> 
    <p>The reason for why the dependencies are added as code-dependencies and why the scope is set the way it is is described in the <a href="#why_are_the_protocol_and_language_dependencies_done_so_strangely">Why are the protocol and language dependencies done so strangely?</a> section.</p> 
   </div> 
  </div> 
  <div class="sect2"> 
   <h3 id="_toc_custom_modules1">Custom Modules</h3> 
   <div class="paragraph"> 
    <p>The plugin uses the <a href="https://docs.oracle.com/javase/7/docs/api/java/util/ServiceLoader.html">Java Serviceloader</a> mechanism to find modules.</p> 
   </div> 
   <div class="sect3"> 
    <h4 id="_toc_protocol_modules1">Protocol Modules</h4> 
    <div class="paragraph"> 
     <p>In order to provide a new protocol module, all that is required, it so create a module containing a <code>META-INF/services/org.apache.plc4x.plugins.codegenerator.protocol.Protocol</code> file referencing an implementation of the <code>org.apache.plc4x.plugins.codegenerator.protocol.Protocol</code> interface.</p> 
    </div> 
    <div class="paragraph"> 
     <p>This interface is located in the <code>org.apache.plc4x.plugins:plc4x-code-generation-protocol-base</code> module and generally only defines two methods:</p> 
    </div> 
    <div class="literalblock"> 
     <div class="content"> 
      <pre>package org.apache.plc4x.plugins.codegenerator.protocol;

import org.apache.plc4x.plugins.codegenerator.types.definitions.ComplexTypeDefinition;
import org.apache.plc4x.plugins.codegenerator.types.exceptions.GenerationException;

import java.util.Map;

public interface Protocol {

    /**
     * The name of the protocol what the plugin will use to select the correct protocol module.
     *
     * @return the name of the protocol.
     */
    String getName();

    /**
     * Returns a map of complex type definitions for which code has to be generated.
     *
     * @return the Map of types that need to be generated.
     * @throws GenerationException if anything goes wrong parsing.
     */
    Map&lt;String, ComplexTypeDefinition&gt; getTypeDefinitions() throws GenerationException;

}</pre> 
     </div> 
    </div> 
    <div class="paragraph"> 
     <p>These implementations could use any form of way to generate the Map of `ComplexTypeDefinition’s. They could even be hard coded.</p> 
    </div> 
    <div class="paragraph"> 
     <p>However we have currently implemented utilities for universally providing input:</p> 
    </div> 
    <div class="ulist"> 
     <ul> 
      <li> <p><a href="protocol/mspec.html">MSpec Format</a> PLC4X proprietary format.</p> </li> 
     </ul> 
    </div> 
   </div> 
   <div class="sect3"> 
    <h4 id="_toc_language_modules1">Language Modules</h4> 
    <div class="paragraph"> 
     <p>Analog to the <a href="#protocol_modules">Protocol Modules</a> the Language modules are constructed equally.</p> 
    </div> 
    <div class="paragraph"> 
     <p>The <code>Language</code> interface is very simplistic too and is located in the <code>org.apache.plc4x.plugins:plc4x-code-generation-language-base</code> module and generally only defines two methods:</p> 
    </div> 
    <div class="literalblock"> 
     <div class="content"> 
      <pre>package org.apache.plc4x.plugins.codegenerator.language;

import org.apache.plc4x.plugins.codegenerator.types.definitions.ComplexTypeDefinition;
import org.apache.plc4x.plugins.codegenerator.types.exceptions.GenerationException;

import java.io.File;
import java.util.Map;

public interface LanguageOutput {

    /**
     * The name of the template is what the plugin will use to select the correct language module.
     *
     * @return the name of the template.
     */
    String getName();

    void generate(File outputDir, String packageName, Map&lt;String, ComplexTypeDefinition&gt; types)
        throws GenerationException;

}</pre> 
     </div> 
    </div> 
    <div class="paragraph"> 
     <p>The file for registering Language modules is located at: <code>META-INF/services/org.apache.plc4x.plugins.codegenerator.language.LanguageOutput</code></p> 
    </div> 
    <div class="paragraph"> 
     <p>Same as with the protocol modules, the language modules could too be implemented in any thinkable way, however we have already implemented some helpers for using:</p> 
    </div> 
    <div class="ulist"> 
     <ul> 
      <li> <p><a href="language/freemarker.html">Apache Freemarker Format</a> Generate output using <a href="https://freemarker.apache.org">Apache Freemarker</a> Project.</p> </li> 
     </ul> 
    </div> 
   </div> 
  </div> 
  <div class="sect2"> 
   <h3 id="_toc_problems_with_maven1">Problems with Maven</h3> 
   <div class="sect3"> 
    <h4 id="_toc_why_are_the_4_modules_released_separately1">Why are the 4 modules released separately?</h4> 
    <div class="paragraph"> 
     <p>We mentioned in the introduction, that the first 4 modules are maintained and released from outside the main PLC4X repository.</p> 
    </div> 
    <div class="paragraph"> 
     <p>This is due to some restrictions in Maven, which result from the way Maven generally works.</p> 
    </div> 
    <div class="paragraph"> 
     <p>The main problem is that when starting a build, in the <code>validate</code> phase, Maven goes through the configuration, downloads the plugins and configures these. This means that Maven also tries to download the dependencies of the plugins too.</p> 
    </div> 
    <div class="paragraph"> 
     <p>In case of using a Maven plugin in a project which also produces the maven plugin, this is guaranteed to fail - Especially during releases. While during normal development, Maven will probably just download the latest <code>SNAPSHOT</code> from our Maven repository and be happy with this and not complain that this version will be overwritten later on in the build. It will just use the new version as soon as it has to.</p> 
    </div> 
    <div class="paragraph"> 
     <p>During releases however the release plugin changes the version to a release version and then spawns a build. In this case the build will fail because there is no Plugin with that version to download. In this case the only option would be to manually build and install the plugin in the release version and to re-start the release (Which is not a nice thing for the release manager).</p> 
    </div> 
    <div class="paragraph"> 
     <p>For this reason we have stripped down the plugin and it’s dependencies to an absolute minimum and have released (or will release) that separately from the rest, hoping due to the minimality of the dependencies that we will not have to do it very often.</p> 
    </div> 
    <div class="paragraph"> 
     <p>As soon as the tooling is released, the version is updated in the PLC4X build and the release version is used without any complications.</p> 
    </div> 
   </div> 
   <div class="sect3"> 
    <h4 id="_toc_why_are_the_protocol_and_language_dependencies_don">Why are the protocol and language dependencies done so strangely?</h4> 
    <div class="paragraph"> 
     <p>It would certainly be a lot cleaner, if we provided the modules as plugin dependencies.</p> 
    </div> 
    <div class="paragraph"> 
     <p>However, as we mentioned in the previous sub-chapter, Maven tries to download and configure the plugins prior to running the build. So during a release the new versions of the modules wouldn’t exist, this would cause the build to fail.</p> 
    </div> 
    <div class="paragraph"> 
     <p>We could release the protocol- and the language modules separately too, but we want the language and protocol modules to be part of the project, to not over-complicate things - especially during a release.</p> 
    </div> 
    <div class="paragraph"> 
     <p>So the Maven plugin is built in a way, that it uses the modules dependencies and creates it’s own Classloader to contain all of these modules at runtime.</p> 
    </div> 
    <div class="paragraph"> 
     <p>This brings the benefit of being able to utilize Maven’s capability of determining the build order and dynamically creating the modules build classpath.</p> 
    </div> 
    <div class="paragraph"> 
     <p>Adding a normal dependency however would make Maven deploy the artifacts with the rest of the modules.</p> 
    </div> 
    <div class="paragraph"> 
     <p>We don’t want that as the modules are useless as soon as they have been used to generate the code.</p> 
    </div> 
    <div class="paragraph"> 
     <p>So we use a trick that is usually used in Web applications, for example: Here the vendor of a Servlet engine is expected to provide an implementation of the <code>Servlet API</code>. It is forbidden for an application to bring this along, but it is required to build the application.</p> 
    </div> 
    <div class="paragraph"> 
     <p>For this the Maven scope <code>provided</code>, which tells Maven to provide it during the build, but to exclude it from any applications it builds because it will be provided by the system running the application.</p> 
    </div> 
    <div class="paragraph"> 
     <p>This is not quite true, but it does the trick.</p> 
    </div> 
   </div> 
  </div> 
 </div> 
</div>      </div>
    </div>
  </div> <!-- /row -->
  </div>
    </div> <!-- end : row -->
</div> <!-- /container -->
  <!-- Footer
  ================================================== -->
  <footer class="well">
    <div class="container">
      <div class="row">
            <div class="col-md-3 bottom-nav">

                <ul class="nav nav-list">
                    <li class="nav-header">Reports</li>
                    <li ><a  href="../../project-info.html"  title="Project Information" >Project Information <i class="glyphicon glyphicon-chevron-right"></i></a></li>
                </ul>

            </div>
            <div class="col-md-3 bottom-nav">

                <ul class="nav nav-list">
                    <li class="nav-header">Apache</li>
                    <li ><a  href="http://www.apache.org"  title="Apache Software Foundation"  class="externalLink" >Apache Software Foundation</a></li>
                    <li ><a  href="https://www.apache.org/foundation/how-it-works.html"  title="How Apache Works"  class="externalLink" >How Apache Works</a></li>
                    <li ><a  href="http://www.apache.org/licenses"  title="License"  class="externalLink" >License</a></li>
                    <li ><a  href="http://www.apache.org/foundation/sponsorship.html"  title="Sponsoring Apache"  class="externalLink" >Sponsoring Apache</a></li>
                    <li ><a  href="http://www.apache.org/foundation/thanks.html"  title="Thanks"  class="externalLink" >Thanks</a></li>
                </ul>

            </div>
            <div class="col-md-3 bottom-nav">

                <ul class="nav nav-list">
                    <li class="nav-header">Modules</li>
                    <li ><a  href="../../plc4x-build-utils/index.html"  title="PLC4X: Build Utils" >PLC4X: Build Utils</a></li>
                    <li ><a  href="../../plc4x-protocols/index.html"  title="Protocols" >Protocols</a></li>
                    <li ><a  href="../../plc4x-tools/index.html"  title="Tools" >Tools</a></li>
                    <li ><a  href="../../plc4j/index.html"  title="PLC4J" >PLC4J</a></li>
                    <li ><a  href="../../plc4net/index.html"  title="PLC4Net" >PLC4Net</a></li>
                    <li ><a  href="../../plc4py/index.html"  title="PLC4PY" >PLC4PY</a></li>
                </ul>

            </div>
            <div class="col-md-3 bottom-nav">

                <ul class="nav nav-list">
                    <li class="nav-header">Protocols</li>
                    <li ><a  href="../../protocols/features.html"  title="Features" >Features</a></li>
                    <li ><a  href="../../protocols/ads/index.html"  title="ADS" >ADS</a></li>
                    <li ><a  href="../../protocols/delta-v/index.html"  title="DeltaV" >DeltaV</a></li>
                    <li ><a  href="../../protocols/ethernet-ip/index.html"  title="EtherNet/IP" >EtherNet/IP</a></li>
                    <li ><a  href="../../protocols/modbus/index.html"  title="Modbus" >Modbus</a></li>
                    <li ><a  href="../../protocols/opc-ua/index.html"  title="OPC-UA" >OPC-UA</a></li>
                    <li ><a  href="../../protocols/s7/index.html"  title="S7" >S7</a></li>
                </ul>

            </div>
      </div>
    </div>
  </footer>
  <div class="container subfooter">
    <div class="row">
      <div class="col-md-12">
        <p class="pull-right"><a id="m-scroll-top" href="#">Back to top</a></p>
        <p class="copyright">Copyright &copy;2017-2019                 <a href="https://www.apache.org/">The Apache Software Foundation</a>
. All Rights Reserved.</p>
        <p><a href="https://github.com/devacfr/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://devacfr.github.io" target="_blank" title="devacfr">devacfr</a>.</p>

      </div>
    </div>
  </div>
  <!-- Le javascript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
    <script src="../../js/jquery.min.js"></script>
  <script src="../../js/bootstrap.min.js"></script>

  <script src="../../js/lightbox.min.js"></script>

  <script src="../../js/reflow-scroll.js"></script>
	<script src="../../js/highlight.min.js"></script>
  <script src="../../js/reflow-skin.js"></script>
    <script src="../../js/anchor.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function(event) {
            anchors.options = {
              placement: 'left',
            };
            anchors.add('h1,h2, h3, h4, h5, h6');
        });
    </script>

  </body>
</html>