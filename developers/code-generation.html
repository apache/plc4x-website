

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
 Generated by Apache Maven Doxia
 Rendered using Reflow Maven Skin 1.5.0 (http://devacfr.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">
          
        <head>
    <meta charset="UTF-8" />
    <title>Apache PLC4X® - Code Generation</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
      <meta http-equiv="content-language" content="en" />
                                                                <link href="../css/bootstrap.min.css" rel="stylesheet" />
                <link href="../css/docs.css" rel="stylesheet" />
    <link href="../css/reflow-skin.css" rel="stylesheet" />

    <link rel="stylesheet" href="../js/styles/default.min.css" />

    <link href="../css/lightbox.css" rel="stylesheet" />
    <link href="../css/site.css" rel="stylesheet" />
    <link href="../css/print.css" rel="stylesheet" media="print" />
<script>
          document.addEventListener("DOMContentLoaded", function(event) {
            /* Add an image for promoting Apache events below the right banner */
            $("#bannerRight").append('<p id="apacheEvents"><a href="//www.apache.org/events/current-event.html"><img src="//www.apache.org/events/current-event-234x60.png"/></a></p>');
            /* Append the trademarks info to the copyright section */
            $(".copyright").append('<p>Apache PLC4X, PLC4X, Apache, the Apache feather logo, and the Apache PLC4X project logo are either registered trademarks or trademarks of The Apache Software Foundation in the United States and other countries. All other marks mentioned may be trademarks or registered trademarks of their respective owners.</p>');
          });
        </script>
        </head> <!-- end : head -->
    <body class="page-developers-code-generation project-plc4x-parent">

    <div id="m-top-navbar" class="navbar  navbar-default navbar-fixed-top">
      <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                        data-target="#top-navbar-collapse-1" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    </button>
                        <a class="navbar-brand" href="..">Apache PLC4X</a>
        </div> <!-- .navbar-header -->
        <div class="collapse navbar-collapse" id="top-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Users <b class="caret"></b></a>
                <ul class="dropdown-menu">
                    <li ><a  href="../users/download.html"  title="Download" >Download</a></li>
                    <li ><a  href="../users/gettingstarted.html"  title="Getting Started" >Getting Started</a></li>
                    <li ><a  href="../users/opm.html"  title="Object PLC Mapping (OPM)" >Object PLC Mapping (OPM)</a></li>
                    <li ><a  href="../users/industry40.html"  title="Industry 4.0 with Apache" >Industry 4.0 with Apache</a></li>
                    <li ><a  href="../users/security.html"  title="Security" >Security</a></li>
            </ul>
        </li>
                            <li class="dropdown active">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Developers <b class="caret"></b></a>
                <ul class="dropdown-menu">
                    <li ><a  href="issues.html"  title="Bug & Issue Tracker" >Bug & Issue Tracker</a></li>
                    <li ><a  href="building.html"  title="Building PLC4X" >Building PLC4X</a></li>
                    <li ><a  href="sonar.html"  title="Code Analysis" >Code Analysis</a></li>
                                    <li  class="active" ><a  href=""  title="Code Generation" >Code Generation</a></li>
                    <li ><a  href="ci.html"  title="Continuous Integration" >Continuous Integration</a></li>
                    <li ><a  href="contributing.html"  title="Contributing" >Contributing</a></li>
                    <li ><a  href="decisions.html"  title="Decision Making" >Decision Making</a></li>
                    <li ><a  href="maturity.html"  title="Maturity" >Maturity</a></li>
                    <li ><a  href="preparing.html"  title="Preparing your Computer" >Preparing your Computer</a></li>
                    <li ><a  href="release.html"  title="Releasing" >Releasing</a></li>
                    <li ><a  href="team.html"  title="Team" >Team</a></li>
                    <li ><a  href="vm.html"  title="VM Access" >VM Access</a></li>
                    <li ><a  href="vpn.html"  title="VPN Access" >VPN Access</a></li>
                    <li ><a  href="website.html"  title="Website" >Website</a></li>
                    <li ><a  href="wiki.html"  title="Wiki" >Wiki</a></li>
            </ul>
        </li>
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Protocols <b class="caret"></b></a>
                <ul class="dropdown-menu">
                    <li ><a  href="../protocols/features.html"  title="Features" >Features</a></li>
                    <li ><a  href="../protocols/ads/index.html"  title="ADS" >ADS</a></li>
                    <li ><a  href="../protocols/delta-v/index.html"  title="DeltaV" >DeltaV</a></li>
                    <li ><a  href="../protocols/ethernet-ip/index.html"  title="EtherNet/IP" >EtherNet/IP</a></li>
                    <li ><a  href="../protocols/modbus/index.html"  title="Modbus" >Modbus</a></li>
                    <li ><a  href="../protocols/opc-ua/index.html"  title="OPC-UA" >OPC-UA</a></li>
                    <li ><a  href="../protocols/s7/index.html"  title="S7" >S7</a></li>
            </ul>
        </li>
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reports <b class="caret"></b></a>
                <ul class="dropdown-menu">
                    <li class="dropdown-submenu ">
<a  href="../project-info.html"  title="Project Information" >Project Information</a>                    <ul class="dropdown-menu">
                        <li ><a  href="../dependency-convergence.html"  title="Dependency Convergence" >Dependency Convergence</a></li>
                        <li ><a  href="../dependency-info.html"  title="Dependency Information" >Dependency Information</a></li>
                        <li ><a  href="../dependency-management.html"  title="Dependency Management" >Dependency Management</a></li>
                        <li ><a  href="../distribution-management.html"  title="Distribution Management" >Distribution Management</a></li>
                        <li ><a  href="../index.html"  title="About" >About</a></li>
                        <li ><a  href="../issue-management.html"  title="Issue Management" >Issue Management</a></li>
                        <li ><a  href="../licenses.html"  title="Licenses" >Licenses</a></li>
                        <li ><a  href="../mailing-lists.html"  title="Mailing Lists" >Mailing Lists</a></li>
                        <li ><a  href="../modules.html"  title="Project Modules" >Project Modules</a></li>
                        <li ><a  href="../plugin-management.html"  title="Plugin Management" >Plugin Management</a></li>
                        <li ><a  href="../plugins.html"  title="Plugins" >Plugins</a></li>
                        <li ><a  href="../scm.html"  title="Source Code Management" >Source Code Management</a></li>
                        <li ><a  href="../summary.html"  title="Summary" >Summary</a></li>
                    </ul>
                </li>
            </ul>
        </li>
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Apache <b class="caret"></b></a>
                <ul class="dropdown-menu">
                    <li ><a  href="http://www.apache.org"  title="Apache Software Foundation"  class="externalLink" >Apache Software Foundation</a></li>
                    <li ><a  href="https://www.apache.org/foundation/how-it-works.html"  title="How Apache Works"  class="externalLink" >How Apache Works</a></li>
                    <li ><a  href="http://www.apache.org/licenses"  title="License"  class="externalLink" >License</a></li>
                    <li ><a  href="http://www.apache.org/foundation/sponsorship.html"  title="Sponsoring Apache"  class="externalLink" >Sponsoring Apache</a></li>
                    <li ><a  href="http://www.apache.org/foundation/thanks.html"  title="Thanks"  class="externalLink" >Thanks</a></li>
            </ul>
        </li>
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Modules <b class="caret"></b></a>
                <ul class="dropdown-menu">
                    <li ><a  href="../plc4x-protocols/index.html"  title="Protocols" >Protocols</a></li>
                    <li ><a  href="../plc4x-tools/index.html"  title="Tools" >Tools</a></li>
                    <li ><a  href="../plc4j/index.html"  title="PLC4J" >PLC4J</a></li>
                    <li ><a  href="../plc4net/index.html"  title="PLC4Net" >PLC4Net</a></li>
                    <li ><a  href="../plc4py/index.html"  title="PLC4PY" >PLC4PY</a></li>
            </ul>
        </li>
            </ul>
        </div><!--/.nav-collapse -->
      </div> <!--/.container -->
    </div> <!--/.navbar -->
  <div class="container">
  <!-- Masthead -->
  <!-- ================================================== -->  <div class="header container-fluid">
  <div class="jumbotron subhead">
    <div class="row" id="banner">
      <div class="col-md-12">
        <div class="pull-left">
                                      <a href="https://plc4x.apache.org/" id="bannerLeft">
                    <img src="https://plc4x.apache.org/images/apache_plc4x_logo.png"
                 alt='"'Apache PLC4X'"'
 />            </a>
                    <p class="lead">The industrial IoT adapter</p>
        </div>
        <div class="pull-right">
                                      <a href="http://www.apache.org/" id="bannerRight">
                    <img src="https://plc4x.apache.org/images/apache_logo.png"
                 alt='"'Apache Software Foundation'"'
 />            </a>
        </div>
      </div>
    </div>
  </div>
    <hr class="toc-separator" />
    <div id="toc-bar" class="navbar navbar-default">
      <div id="toc-scroll-target" class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#toc-nav-collapse" aria-expanded="false">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
            </div> <!-- .navbar-header -->
        <div class="collapse navbar-collapse" id="toc-nav-collapse">
          <ul id="toc" class="nav navbar-nav">
                                                            <li class="toplevel"><a href="#_toc_code_generation1" title="Code Generation">Code Generation</a></li>
                        <li class="toplevel"><a href="#_toc_introduction1" title="Introduction">Introduction</a></li>
                        <li class="dropdown">
                            <a href="#" title="The MSpec format" class="dropdown-toggle" role="button" data-toggle="dropdown">The MSpec format <b class="caret"></b></a>
                            <ul class="dropdown-menu" role="menu">
                                <!-- Repeat the item, otherwise it is not clickable as the dropdown root -->
                                <li><a href="#_toc_the_mspec_format1" title="The MSpec format">The MSpec format</a></li>
                                <li class="divider"></li>
                                              <li><a href="#_toc_simple_types1" title="Simple Types">Simple Types</a></li>
                <li><a href="#_toc_complex_types1" title="Complex Types">Complex Types</a></li>
                <li class="dropdown-submenu">
                    <a href="#_toc_field_types_and_their_syntax1" title="Field Types and their Syntax">Field Types and their Syntax</a>
                    <ul class="dropdown-menu" role="menu">
                <li><a href="#_toc_const_field1" title="const Field">const Field</a></li>
                <li><a href="#_toc_reserved_field1" title="reserved Field">reserved Field</a></li>
                <li><a href="#_toc_field_field1" title="field Field">field Field</a></li>
                <li><a href="#_toc_array_field1" title="array Field">array Field</a></li>
                <li><a href="#_toc_optional_field1" title="optional Field">optional Field</a></li>
                <li><a href="#_toc_implicit_field1" title="implicit Field">implicit Field</a></li>
                <li><a href="#_toc_discriminator_field1" title="discriminator Field">discriminator Field</a></li>
                <li><a href="#_toc_typeswitch_field1" title="typeSwitch Field">typeSwitch Field</a></li>
                <li><a href="#_toc_parameters1" title="Parameters">Parameters</a></li>
                    </ul>
                </li>
                            </ul>
                        </li>
                        <li class="divider-vertical"></li>
                                    <li class="toplevel"><a href="#_toc_problems_with_maven1" title="Problems with Maven">Problems with Maven</a></li>
                        <li class="toplevel"><a href="#_toc_why_are_the_4_modules_released_separately1" title="Why are the 4 modules released separately?">Why are the 4 modules released separately?</a></li>
                        <li class="toplevel"><a href="#_toc_why_are_the_protocol_and_language_dependencies_don" title="Why are the protocol and language dependencies done so strangely?">Why are the protocol and language dependencies done so strangely?</a></li>
          </ul>
        </div>
      </div> <!-- .container -->
    </div> <!-- end: toc-bar -->
  </div> <!-- end : header -->
  <div class="main-body">

  <div class="row">
    <div class="col-md-12">
      <div class="body-content">
<div class="sect1"> 
 <div class="page-header">
  <h2 id="_toc_code_generation1">Code Generation</h2>
 </div> 
 <div class="sectionbody"> 
  <div class="paragraph"> 
   <p>As hand-writing code for a lot of drivers in multiple languages would be quite a nightmare, we have invested a very large amount of time into finding a way to automate this.</p> 
  </div> 
  <div class="paragraph"> 
   <p>So in the end we need 3 parts:</p> 
  </div> 
  <div class="olist arabic"> 
   <ol class="arabic"> 
    <li> <p>Protocol definition</p> </li> 
    <li> <p>Language template</p> </li> 
    <li> <p>A maven plugin which generates the code</p> </li> 
   </ol> 
  </div> 
  <div class="paragraph"> 
   <p>This maven plugin uses a given protocol definition as well as a language template and generates code for reading/writing data in that protocol with the given language.</p> 
  </div> 
  <div class="imageblock"> 
   <div class="content"> 
    <img src="../images/code-generation-intro.png" alt="code generation intro" width="750" height="308" class="img-responsive"> 
   </div> 
  </div> 
  <div class="paragraph"> 
   <p>The <code>Types Base</code> module provides all the structures the <code>Protocol</code> modules output which are then used in the <code>Language</code> templates to generate code.</p> 
  </div> 
  <div class="paragraph"> 
   <p><code>Protocol Base</code> and <code>Language Base</code> hereby just provide the interfaces that reference these types and provide the API for the <code>plc4x-maven-plugin</code> to use.</p> 
  </div> 
  <div class="paragraph"> 
   <p>These modules are also maintained in a repository which is separate from the rest of the PLC4X code.</p> 
  </div> 
  <div class="paragraph"> 
   <p>This is due to some restrictions in the Maven build system. If you are interested in understanding the reasons - please read the chapter on <code>Problems with Maven</code> near the end of this page.</p> 
  </div> 
  <div class="paragraph"> 
   <p>Concrete protocol spec parsers and templates that actually generate code are implemented in derived modules.</p> 
  </div> 
  <div class="paragraph"> 
   <p>Also didn’t we want to tie ourselves to only one way to specify protocols and to generate code.</p> 
  </div> 
  <div class="paragraph"> 
   <p>This adds another layer to the hierarchy.</p> 
  </div> 
  <div class="paragraph"> 
   <p>So for example in case of generating a Siemens S7 Driver for Java this would look like this:</p> 
  </div> 
  <div class="imageblock"> 
   <div class="content"> 
    <img src="../images/code-generation-intro-s7-java.png" alt="code generation intro s7 java" width="480" height="728" class="img-responsive"> 
   </div> 
  </div> 
  <div class="paragraph"> 
   <p>The dark blue parts are the ones released externally, the turquoise ones are part of the main PLC4X repo.</p> 
  </div> 
  <div class="sect2"> 
   <h3 id="_toc_introduction1">Introduction</h3> 
   <div class="paragraph"> 
    <p>The maven plugin is built up very modular.</p> 
   </div> 
   <div class="paragraph"> 
    <p>So in general it is possible to add new forms of providing protocol definitions as well as language templates.</p> 
   </div> 
   <div class="paragraph"> 
    <p>For the formats of specifying a protocol we have tried out numerous tools and frameworks, however the results were never quite satisfying.</p> 
   </div> 
   <div class="paragraph"> 
    <p>Usually using them required a large amount of workarounds, which made the solution quite complicated.</p> 
   </div> 
   <div class="paragraph"> 
    <p>In the end only DFDL and the corresponding Apache project <a href="https://daffodil.apache.org">Apache Daffodil (incubating)</a> seemed to provide what we were looking for.</p> 
   </div> 
   <div class="paragraph"> 
    <p>With this we were able to provide first driver versions fully specified in XML.</p> 
   </div> 
   <div class="paragraph"> 
    <p>The downside was, that the PLC4X community regarded this XML format as pretty complicated and when implementing an experimental code generator we quickly noticed that generating a nice object model would not be possible, due to the lack ability to model the inheritance of types in DFDL.</p> 
   </div> 
   <div class="paragraph"> 
    <p>In the end we came up with our own solution.</p> 
   </div> 
  </div> 
  <div class="sect2"> 
   <h3 id="_toc_the_mspec_format1">The MSpec format</h3> 
   <div class="paragraph"> 
    <p>The <code>MSpec</code> format (Message Specification) was a result of a brainstorming session after evaluating a lot of other options.</p> 
   </div> 
   <div class="paragraph"> 
    <p>We simply sat down and started to write some imaginary format (<code>imaginary</code> was even the initial Name we used) and created parses for this afterwards and fine tuned spec and parsers as part of the process of implementing first protocols and language templates.</p> 
   </div> 
   <div class="paragraph"> 
    <p>It’s a text-based format.</p> 
   </div> 
   <div class="paragraph"> 
    <p>At the root level of these specs are a set of <code>type</code> or <code>discriminatedType</code> blocks.</p> 
   </div> 
   <div class="paragraph"> 
    <p><code>type</code> elements are objects that are independent from the input.</p> 
   </div> 
   <div class="paragraph"> 
    <p>An example would be the <code>TPKTPacket</code> of the S7 format:</p> 
   </div> 
   <div class="literalblock"> 
    <div class="content"> 
     <pre>[type 'TPKTPacket'
    [const    uint 8     'protocolId' '0x03']
    [reserved uint 8     '0x00']
    [implicit uint 16    'len'        'payload.lengthInBytes + 4']
    [field    COTPPacket 'payload']
]</pre> 
    </div> 
   </div> 
   <div class="paragraph"> 
    <p>A <code>discriminatedType</code> type is in contrast an object who’s content is dependent in the input.</p> 
   </div> 
   <div class="paragraph"> 
    <p>Every discriminated type can contain at most one <code>discriminator</code> field and exactly one <code>typeSwitch</code> element.</p> 
   </div> 
   <div class="paragraph"> 
    <p>For example part of the spec for the S7 format looks like this:</p> 
   </div> 
   <div class="literalblock"> 
    <div class="content"> 
     <pre>[discriminatedType 'S7Message'
    [const         uint 8  'protocolId'      '0x32']
    [discriminator uint 8  'messageType']
    [reserved      uint 16 '0x0000']
    [field         uint 16 'tpduReference']
    [implicit      uint 16 'parameterLength' 'parameter.lengthInBytes']
    [implicit      uint 16 'payloadLength'   'payload.lengthInBytes']
    [typeSwitch 'messageType'
        ['0x01' S7MessageRequest
        ]
        ['0x03' S7MessageResponse
            [field uint 8 'errorClass']
            [field uint 8 'errorCode']
        ]
        ['0x07' S7MessageUserData
        ]
    ]
    [field S7Parameter 'parameter' ['messageType']]
    [field S7Payload   'payload'   ['messageType', 'parameter']]
]</pre> 
    </div> 
   </div> 
   <div class="paragraph"> 
    <p>An types start is declared by an opening square bracket <code>[</code> and ended with a closing one <code>]</code>.</p> 
   </div> 
   <div class="paragraph"> 
    <p>Also to both provide a name as first argument.</p> 
   </div> 
   <div class="paragraph"> 
    <p>Every type definition contains a list of fields that can have different types.</p> 
   </div> 
   <div class="paragraph"> 
    <p>The list of available types are:</p> 
   </div> 
   <div class="ulist"> 
    <ul> 
     <li> <p>const: expects a given value</p> </li> 
     <li> <p>reserved: expects a given value, but only warns if condition is not meet</p> </li> 
     <li> <p>field: simple or complex typed object</p> </li> 
     <li> <p>array: array of simple or complex typed objects</p> </li> 
     <li> <p>optional: simple or complex typed object, that is only present in some conditions</p> </li> 
     <li> <p>implicit: a field required for parsing, but is usually defined though other data</p> </li> 
     <li> <p>discriminator: special type of simple typed field which is used to determine the concrete type of an object (max one per type and always has to be accompanied with a <code>switch</code> field) (reserved for <code>discriminatedType</code>)</p> </li> 
     <li> <p>typeSwitch: not a real field, but indicates the existence of sub-types, which are declared inline (reserved for <code>discriminatedType</code>)</p> </li> 
    </ul> 
   </div> 
   <div class="paragraph"> 
    <p>The full syntax and explanations of these type follow in the following chapters.</p> 
   </div> 
   <div class="paragraph"> 
    <p>Another thing we have to explain are how types are specified.</p> 
   </div> 
   <div class="paragraph"> 
    <p>In general we distinguish between two types of types used in field definitions:</p> 
   </div> 
   <div class="ulist"> 
    <ul> 
     <li> <p>simple types</p> </li> 
     <li> <p>complex types</p> </li> 
    </ul> 
   </div> 
   <div class="sect3"> 
    <h4 id="_toc_simple_types1">Simple Types</h4> 
    <div class="paragraph"> 
     <p>Simple types are usually raw data the format is:</p> 
    </div> 
    <div class="literalblock"> 
     <div class="content"> 
      <pre>{base-type} {size}</pre> 
     </div> 
    </div> 
    <div class="paragraph"> 
     <p>The base types available are currently:</p> 
    </div> 
    <div class="ulist"> 
     <ul> 
      <li> <p><strong>bit</strong>: Simple boolean value</p> </li> 
      <li> <p><strong>uint</strong>: The input is treated as unsigned integer value</p> </li> 
      <li> <p><strong>int</strong>: The input is treated as signed integer value</p> </li> 
      <li> <p><strong>float</strong>: The input is treated as floating point number</p> </li> 
      <li> <p><strong>string</strong>: The input is treated as string</p> </li> 
     </ul> 
    </div> 
    <div class="paragraph"> 
     <p>The size value then provides how many <code>bits</code> should be read.</p> 
    </div> 
    <div class="paragraph"> 
     <p>In case of <code>string</code> types, it refers to the number of characters.</p> 
    </div> 
    <div class="paragraph"> 
     <p>So reading an unsigned byte would be: <code>uint 8</code>.</p> 
    </div> 
   </div> 
   <div class="sect3"> 
    <h4 id="_toc_complex_types1">Complex Types</h4> 
    <div class="paragraph"> 
     <p>In contrast to simple types, complex type reference other complex types (Root elements of the spec document).</p> 
    </div> 
    <div class="paragraph"> 
     <p>How the parser should interpret them is defined in the referenced types definition.</p> 
    </div> 
    <div class="paragraph"> 
     <p>In the example above, for example the <code>S7Parameter</code> is defined in another part of the spec.</p> 
    </div> 
   </div> 
   <div class="sect3"> 
    <h4 id="_toc_field_types_and_their_syntax1">Field Types and their Syntax</h4> 
    <div class="sect4"> 
     <h5 id="_toc_const_field1">const Field</h5> 
     <div class="literalblock"> 
      <div class="content"> 
       <pre>[const {simple-type} {size} '{name}' '{reference}']</pre> 
      </div> 
     </div> 
     <div class="paragraph"> 
      <p>A const field simply reads a given simple type and compares to a given reference value.</p> 
     </div> 
     <div class="paragraph"> 
      <p>It makes the parser throw an Exception if the value does not match.</p> 
     </div> 
    </div> 
    <div class="sect4"> 
     <h5 id="_toc_reserved_field1">reserved Field</h5> 
     <div class="literalblock"> 
      <div class="content"> 
       <pre>[reserved {simple-type} {size} '{name}' '{reference}']</pre> 
      </div> 
     </div> 
     <div class="paragraph"> 
      <p>In general this field type behaves exactly the same way as the <code>const</code> field, but with the difference, that it doesn’t throw an Exception if the reference is not matched, but instead allows to log the value.</p> 
     </div> 
     <div class="paragraph"> 
      <p>This is used in order to detect <code>reserved</code> fields in some protocols, where the manufacturer defined the field to be a given value, but with the option to use it in the future.</p> 
     </div> 
     <div class="paragraph"> 
      <p>This way the application will not break in the future if devices start using the field and it informs us that we should probably have a look at what the new values mean.</p> 
     </div> 
    </div> 
    <div class="sect4"> 
     <h5 id="_toc_field_field1">field Field</h5> 
     <div class="literalblock"> 
      <div class="content"> 
       <pre>[field {simple-type} {size} '{name}']</pre> 
      </div> 
     </div> 
     <div class="literalblock"> 
      <div class="content"> 
       <pre>[field {complex-type} '{name}']</pre> 
      </div> 
     </div> 
    </div> 
    <div class="sect4"> 
     <h5 id="_toc_array_field1">array Field</h5> 
     <div class="literalblock"> 
      <div class="content"> 
       <pre>[arrayField {simple-type} {size} '{name}' {'count' or 'length'} '{count or length expression}']</pre> 
      </div> 
     </div> 
     <div class="literalblock"> 
      <div class="content"> 
       <pre>[arrayField {complex-type} '{name}' {'count' or 'length'} '{count or length expression}']</pre> 
      </div> 
     </div> 
    </div> 
    <div class="sect4"> 
     <h5 id="_toc_optional_field1">optional Field</h5> 
     <div class="literalblock"> 
      <div class="content"> 
       <pre>[optionalField {simple-type} {size} '{name}' '{optional-expression}']</pre> 
      </div> 
     </div> 
     <div class="literalblock"> 
      <div class="content"> 
       <pre>[optionalField {complex-type} '{name}' '{optional-expression}']</pre> 
      </div> 
     </div> 
    </div> 
    <div class="sect4"> 
     <h5 id="_toc_implicit_field1">implicit Field</h5> 
     <div class="literalblock"> 
      <div class="content"> 
       <pre>[implicit {simple-type} {size} '{name}' '{serialization-expression}']</pre> 
      </div> 
     </div> 
     <div class="literalblock"> 
      <div class="content"> 
       <pre>[implicit {complex-type} '{name}' '{serialization-expression}']</pre> 
      </div> 
     </div> 
    </div> 
    <div class="sect4"> 
     <h5 id="_toc_discriminator_field1">discriminator Field</h5> 
     <div class="literalblock"> 
      <div class="content"> 
       <pre>[discriminator {simple-type} {size} '{name}']</pre> 
      </div> 
     </div> 
    </div> 
    <div class="sect4"> 
     <h5 id="_toc_typeswitch_field1">typeSwitch Field</h5> 
     <div class="literalblock"> 
      <div class="content"> 
       <pre>[typeSwitch '{arument-1}', '{arument-2}', ...
    ['{argument-1-value-1}' {subtype-1-name}
        ... Fields ...
    ]
    ['{vargument-1-value-2}', '{argument-2-value-1}' {subtype-2-name}
        ... Fields ...
    ]
    ['{vargument-1-value-3}', '{argument-2-value-2}' {subtype-2-name}
        ... Fields ...
    ]</pre> 
      </div> 
     </div> 
     <div class="paragraph"> 
      <p>A type switch element must contain a list of at least one argument expression.</p> 
     </div> 
     <div class="paragraph"> 
      <p>Each sub-type declares a comma-separated list of concrete values.</p> 
     </div> 
     <div class="paragraph"> 
      <p>It must contain at most as many elements as arguments are declared for the type switch.</p> 
     </div> 
     <div class="paragraph"> 
      <p>The matching type is found during parsing by starting with the first argument.</p> 
     </div> 
     <div class="paragraph"> 
      <p>If it matches and there are no more values, the type is found, if more values are provided, they are compared to the other argument values.</p> 
     </div> 
     <div class="paragraph"> 
      <p>If no type is found, an exception is thrown.</p> 
     </div> 
     <div class="paragraph"> 
      <p>Inside each sub-type can declare fields using a subset of the types (<code>discriminator</code> and <code>typeSwitch</code> can’t be used here)</p> 
     </div> 
    </div> 
    <div class="sect4"> 
     <h5 id="_toc_parameters1">Parameters</h5> 
     <div class="paragraph"> 
      <p>Some times it is necessary to pass along additional parameters.</p> 
     </div> 
     <div class="paragraph"> 
      <p>If a complex type requires parameters, these are declared in the header of that type.</p> 
     </div> 
     <div class="literalblock"> 
      <div class="content"> 
       <pre>[discriminatedType 'S7Payload' [uint 8 'messageType', S7Parameter 'parameter']
    [typeSwitch 'parameter.discriminatorValues[0]', 'messageType'
        ['0xF0' S7PayloadSetupCommunication]
        ['0x04','0x01' S7PayloadReadVarRequest]
        ['0x04','0x03' S7PayloadReadVarResponse
            [arrayField S7VarPayloadDataItem 'items' count 'CAST(parameter, S7ParameterReadVarResponse).numItems']
        ]
        ['0x05','0x01' S7PayloadWriteVarRequest
            [arrayField S7VarPayloadDataItem 'items' count 'COUNT(CAST(parameter, S7ParameterWriteVarRequest).items)']
        ]
        ['0x05','0x03' S7PayloadWriteVarResponse
            [arrayField S7VarPayloadStatusItem 'items' count 'CAST(parameter, S7ParameterWriteVarResponse).numItems']
        ]
        ['0x00','0x07' S7PayloadUserData
        ]
    ]
]</pre> 
      </div> 
     </div> 
     <div class="paragraph"> 
      <p>Therefore wherever a complex type is referenced an additional list of parameters can be passed to the next type.</p> 
     </div> 
     <div class="paragraph"> 
      <p>Here comes an example of this in above snippet:</p> 
     </div> 
     <div class="literalblock"> 
      <div class="content"> 
       <pre>[field S7Payload   'payload'   ['messageType', 'parameter']]</pre> 
      </div> 
     </div> 
    </div> 
   </div> 
  </div> 
 </div> 
</div> 
<div class="sect1"> 
 <h2 id="_toc_problems_with_maven1">Problems with Maven</h2> 
 <div class="sectionbody"> 
  <div class="sect2"> 
   <h3 id="_toc_why_are_the_4_modules_released_separately1">Why are the 4 modules released separately?</h3> 
   <div class="paragraph"> 
    <p>We mentioned in the introduction, that the first 4 modules are maintained and released from outside the main PLC4X repository.</p> 
   </div> 
   <div class="paragraph"> 
    <p>This is due to some restrictions in Maven, which result from the way Maven generally works.</p> 
   </div> 
   <div class="paragraph"> 
    <p>The main problem is that when starting a build, in the <code>validate</code> phase, Maven goes through the configuration, downloads the plugins and configures these. This means that Maven also tries to download the dependencies of the plugins too.</p> 
   </div> 
   <div class="paragraph"> 
    <p>In case of using a Maven plugin in a project which also produces the maven plugin, this is guaranteed to fail - Especially during releases. While during normal development, Maven will probably just download the latest <code>SNAPSHOT</code> from our Maven repository and be happy with this and not complain that this version will be overwritten later on in the build. It will just use the new version as soon as it has to.</p> 
   </div> 
   <div class="paragraph"> 
    <p>During releases however the release plugin changes the version to a release version and then spawns a build. In this case the build will fail because there is no Plugin with that version to download. In this case the only option would be to manually build and install the plugin in the release version and to re-start the release (Which is not a nice thing for the release manager).</p> 
   </div> 
   <div class="paragraph"> 
    <p>For this reason we have stripped down the plugin and it’s dependencies to an absolute minimum and have released (or will release) that separately from the rest, hoping due to the minimality of the dependencies that we will not have to do it very often.</p> 
   </div> 
   <div class="paragraph"> 
    <p>As soon as the tooling is released, the version is updated in the PLC4X build and the release version is used without any complications.</p> 
   </div> 
  </div> 
  <div class="sect2"> 
   <h3 id="_toc_why_are_the_protocol_and_language_dependencies_don">Why are the protocol and language dependencies done so strangely?</h3> 
   <div class="paragraph"> 
    <p>It would certainly be a lot cleaner, if we provided the modules as plugin dependencies.</p> 
   </div> 
   <div class="paragraph"> 
    <p>However, as we mentioned in the previous sub-chapter, Maven tries to download and configure the plugins prior to running the build. So during a release the new versions of the modules wouldn’t exist, this would cause the build to fail.</p> 
   </div> 
   <div class="paragraph"> 
    <p>We could release the protocol- and the language modules separately too, but we want the language and protocol modules to be part of the project, to not over-complicate things - especially during a release.</p> 
   </div> 
   <div class="paragraph"> 
    <p>So the Maven plugin is built in a way, that it uses the modules dependencies and creates it’s own Classloader to contain all of these modules at runtime.</p> 
   </div> 
   <div class="paragraph"> 
    <p>This brings the benefit of being able to utilize Maven’s capability of determining the build order and dynamically creating the modules build classpath.</p> 
   </div> 
   <div class="paragraph"> 
    <p>Adding a normal dependency however would make Maven deploy the artifacts with the rest of the modules.</p> 
   </div> 
   <div class="paragraph"> 
    <p>We don’t want that as the modules are useless as soon as they have been used to generate the code.</p> 
   </div> 
   <div class="paragraph"> 
    <p>So we use a trick that is usually used in Web applications, for example: Here the vendor of a Servlet engine is expected to provide an implementation of the <code>Servlet API</code>. It is forbidden for an application to bring this along, but it is required to build the application.</p> 
   </div> 
   <div class="paragraph"> 
    <p>For this the Maven scope <code>provided</code>, which tells Maven to provide it during the build, but to exclude it from any applications it builds because it will be provided by the system running the application.</p> 
   </div> 
   <div class="paragraph"> 
    <p>This is not quite true, but it does the trick.</p> 
   </div> 
  </div> 
 </div> 
</div>      </div>
    </div>
  </div> <!-- /row -->
  </div>
    </div> <!-- end : row -->
</div> <!-- /container -->
  <!-- Footer
  ================================================== -->
  <footer class="well">
    <div class="container">
      <div class="row">
            <div class="col-md-3 bottom-nav">

                <ul class="nav nav-list">
                    <li class="nav-header">Reports</li>
                    <li ><a  href="../project-info.html"  title="Project Information" >Project Information <i class="glyphicon glyphicon-chevron-right"></i></a></li>
                </ul>

            </div>
            <div class="col-md-3 bottom-nav">

                <ul class="nav nav-list">
                    <li class="nav-header">Apache</li>
                    <li ><a  href="http://www.apache.org"  title="Apache Software Foundation"  class="externalLink" >Apache Software Foundation</a></li>
                    <li ><a  href="https://www.apache.org/foundation/how-it-works.html"  title="How Apache Works"  class="externalLink" >How Apache Works</a></li>
                    <li ><a  href="http://www.apache.org/licenses"  title="License"  class="externalLink" >License</a></li>
                    <li ><a  href="http://www.apache.org/foundation/sponsorship.html"  title="Sponsoring Apache"  class="externalLink" >Sponsoring Apache</a></li>
                    <li ><a  href="http://www.apache.org/foundation/thanks.html"  title="Thanks"  class="externalLink" >Thanks</a></li>
                </ul>

            </div>
            <div class="col-md-3 bottom-nav">

                <ul class="nav nav-list">
                    <li class="nav-header">Modules</li>
                    <li ><a  href="../plc4x-protocols/index.html"  title="Protocols" >Protocols</a></li>
                    <li ><a  href="../plc4x-tools/index.html"  title="Tools" >Tools</a></li>
                    <li ><a  href="../plc4j/index.html"  title="PLC4J" >PLC4J</a></li>
                    <li ><a  href="../plc4net/index.html"  title="PLC4Net" >PLC4Net</a></li>
                    <li ><a  href="../plc4py/index.html"  title="PLC4PY" >PLC4PY</a></li>
                </ul>

            </div>
            <div class="col-md-3 bottom-nav">

                <ul class="nav nav-list">
                    <li class="nav-header">Protocols</li>
                    <li ><a  href="../protocols/features.html"  title="Features" >Features</a></li>
                    <li ><a  href="../protocols/ads/index.html"  title="ADS" >ADS</a></li>
                    <li ><a  href="../protocols/delta-v/index.html"  title="DeltaV" >DeltaV</a></li>
                    <li ><a  href="../protocols/ethernet-ip/index.html"  title="EtherNet/IP" >EtherNet/IP</a></li>
                    <li ><a  href="../protocols/modbus/index.html"  title="Modbus" >Modbus</a></li>
                    <li ><a  href="../protocols/opc-ua/index.html"  title="OPC-UA" >OPC-UA</a></li>
                    <li ><a  href="../protocols/s7/index.html"  title="S7" >S7</a></li>
                </ul>

            </div>
      </div>
    </div>
  </footer>
  <div class="container subfooter">
    <div class="row">
      <div class="col-md-12">
        <p class="pull-right"><a id="m-scroll-top" href="#">Back to top</a></p>
        <p class="copyright">Copyright &copy;2017-2019                 <a href="https://www.apache.org/">The Apache Software Foundation</a>
. All Rights Reserved.</p>
        <p><a href="https://github.com/devacfr/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://devacfr.github.io" target="_blank" title="devacfr">devacfr</a>.</p>

      </div>
    </div>
  </div>
  <!-- Le javascript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
    <script src="../js/jquery.min.js"></script>
  <script src="../js/bootstrap.min.js"></script>

  <script src="../js/lightbox.min.js"></script>

  <script src="../js/reflow-scroll.js"></script>
	<script src="../js/highlight.min.js"></script>
  <script src="../js/reflow-skin.js"></script>
    <script src="../js/anchor.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function(event) {
            anchors.options = {
              placement: 'left',
            };
            anchors.add('h1,h2, h3, h4, h5, h6');
        });
    </script>

  </body>
</html>